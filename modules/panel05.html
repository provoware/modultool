<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Panel05 – Persona-Switcher</title>
<style>
  #panel05{display:grid;gap:0.5rem;max-width:340px;margin:auto;font-family:sans-serif;}
  textarea{min-height:80px;resize:vertical;}
  input,select,textarea,button{font-size:1rem;border-radius:0.5rem;}
  @media(min-width:600px){#panel05{max-width:520px;}}
</style>
</head>
<body>
<div id="panel05">
  <h2>Persona-Switcher</h2>
  <label for="persona-name">Name:</label>
  <input id="persona-name" aria-label="Persona-Name">
  <label for="persona-desc">Beschreibung:</label>
  <textarea id="persona-desc" aria-label="Persona-Beschreibung"></textarea>
  <button id="add-btn">Profil speichern</button>
  <label for="persona-select">Profil wählen:</label>
  <select id="persona-select"></select>
  <button id="copy-btn">Kopieren</button>
  <div id="status" role="status" aria-live="polite"></div>
</div>
<script type="module">
const nameInput=document.getElementById('persona-name');
const descInput=document.getElementById('persona-desc');
const addBtn=document.getElementById('add-btn');
const select=document.getElementById('persona-select');
const copyBtn=document.getElementById('copy-btn');
const status=document.getElementById('status');
const STORE_KEY='personas';

function showStatus(msg){status.textContent=msg;setTimeout(()=>status.textContent='',3000);}
function load(){
  try{return JSON.parse(localStorage.getItem(STORE_KEY))||{};}catch(e){showStatus('Speicherfehler');return {};}
}
function save(obj){
  try{localStorage.setItem(STORE_KEY,JSON.stringify(obj));}catch(e){showStatus('Speichern fehlgeschlagen');}
}
function refreshSelect(obj){
  select.innerHTML='';
  Object.keys(obj).forEach(name=>{
    const opt=document.createElement('option');
    opt.value=name;opt.textContent=name;select.appendChild(opt);
  });
}
function loadCurrent(){
  const obj=load();
  const cur=obj[select.value];
  descInput.value=cur?cur.desc:'';
}
addBtn.addEventListener('click',()=>{
  const name=nameInput.value.trim();
  const desc=descInput.value.trim();
  if(!name||!desc){showStatus('Name oder Beschreibung fehlt');return;}
  const obj=load();
  obj[name]={desc};
  save(obj);
  refreshSelect(obj);
  select.value=name;
  showStatus('Profil gespeichert');
});
select.addEventListener('change',loadCurrent);
copyBtn.addEventListener('click',()=>{
  const text=descInput.value.trim();
  if(!text){showStatus('Nichts zum Kopieren');return;}
  navigator.clipboard.writeText(text).then(()=>{
    copyBtn.style.backgroundColor='#15b57b';
    setTimeout(()=>{copyBtn.style.backgroundColor='';},800);
  });
});
refreshSelect(load());
loadCurrent();
</script>
</body>
</html>
